(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[428],{6178:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/complaint/[id]",function(){return s(8069)}])},8069:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var n=s(5893),r=s(1163),a=s(7294),i=s(3299);function l(){let e=(0,r.useRouter)(),{id:t}=e.query,[s,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),{data:b}=(0,i.useSession)();(0,a.useEffect)(()=>{t&&b&&g(t,b.user.id)},[t,b]);let g=async e=>{try{let t=await fetch("https://lightslategray-mink-295930.hostingersite.com/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n            {\n              business(where: { id: "'.concat(e,'" }) {\n                name\n                complaints(where: {\n                  status: { equals: "0" }\n                }) {\n                  subject\n                  content\n                  isAnonymous\n                  status\n                  createdAt\n                  user {\n                    name\n                  }\n                  replies {\n                    content\n                    createdAt\n                  }\n                }\n              }\n            }')})}),s=await t.json();l(s.data.business)}catch(e){console.error("Error fetching business complaints:",e)}},j=async s=>{if(s.preventDefault(),x(!0),!b){e.push("/auth/signin"),x(!1);return}try{let e={subject:o,content:d,businessId:t,userId:b.user.id,isAnonymous:m?"true":"false",status:"1"},s=await fetch("https://lightslategray-mink-295930.hostingersite.com/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n                mutation CreateComplaint($subject: String!, $content: String!, $businessId: ID!, $userId: ID!, $isAnonymous: String!, $status: String!) {\n                    createComplaint(data: {\n                        subject: $subject,\n                        content: $content,\n                        business: { connect: { id: $businessId } },\n                        user: { connect: { id: $userId } },\n                        isAnonymous: $isAnonymous,\n                        status: $status\n                    }) {\n                        id\n                    }\n                }\n            ",variables:e})}),n=await s.json();s.ok&&!n.errors?(c(""),u(""),h(!1),g(t,b.user.id),alert("Complaint submitted successfully! It will be reviewed soon.")):console.error("Error submitting complaint:",n.errors||s.statusText)}catch(e){console.error("Error submitting complaint:",e)}finally{x(!1)}};return(0,n.jsx)("div",{className:"container mx-auto mt-10 p-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"bg-white p-8 shadow-lg rounded-lg border-t-4 border-red-500",children:[(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)("i",{className:"bi bi-exclamation-circle text-red-500 text-3xl mr-2"}),(0,n.jsx)("h2",{className:"text-3xl font-bold",children:"Submit a Complaint"})]}),s&&(0,n.jsxs)("p",{className:"text-gray-600 mb-4",children:["Report your experience with ",(0,n.jsx)("strong",{children:s.name}),"."]}),(0,n.jsxs)("form",{onSubmit:j,children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-lg mb-2",htmlFor:"complaintSubject",children:"Subject"}),(0,n.jsx)("input",{type:"text",id:"complaintSubject",className:"w-full p-3 border rounded-md focus:border-red-500 focus:ring-red-500",placeholder:"Enter the subject of your complaint",value:o,onChange:e=>c(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-lg mb-2",htmlFor:"complaintContent",children:"Your Complaint"}),(0,n.jsx)("textarea",{id:"complaintContent",className:"w-full p-3 border rounded-md focus:border-red-500 focus:ring-red-500",placeholder:"Describe the issue",rows:"4",value:d,onChange:e=>u(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)("input",{type:"checkbox",id:"anonymous",className:"mr-2",checked:m,onChange:e=>h(e.target.checked)}),(0,n.jsx)("label",{htmlFor:"anonymous",className:"text-gray-700",children:"Submit anonymously"})]}),(0,n.jsx)("button",{type:"submit",className:"bg-gradient-to-r from-red-500 to-red-700 text-white px-6 py-3 rounded-full hover:shadow-lg transition duration-300 ease-in-out",disabled:p,children:p?"Submitting...":"Submit Complaint"})]})]}),(0,n.jsxs)("div",{className:"bg-white p-8 shadow-lg rounded-lg border-t-4 border-red-500",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Your Complaints"}),(0,n.jsx)("div",{className:"overflow-y-scroll",style:{maxHeight:"500px"},children:s?s.complaints.length>0?(0,n.jsx)("ul",{children:s.complaints.map((e,t)=>(0,n.jsxs)("li",{className:"mb-4 border-b pb-4",children:[(0,n.jsxs)("p",{className:"font-bold text-gray-700",children:["Subject: ",e.subject]}),(0,n.jsx)("p",{className:"text-gray-700",children:e.content}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["By: ",e.isAnonymous?"Anonymous":e.user.name]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Status: ","0"===e.status?"Closed":"Pending"]}),e.replies&&e.replies.length>0&&(0,n.jsxs)("div",{className:"mt-4 pl-4 border-l-2 border-gray-300",children:[(0,n.jsx)("h4",{className:"text-lg font-semibold mb-2",children:"Replies:"}),(0,n.jsx)("ul",{children:e.replies.map((e,t)=>(0,n.jsxs)("li",{className:"mb-2",children:[(0,n.jsx)("h5",{className:"text-gray-900",children:s.name}),(0,n.jsx)("p",{className:"text-gray-700",children:e.content}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Posted on: ",new Date(e.createdAt).toLocaleDateString()]})]},t))})]})]},t))}):(0,n.jsx)("p",{children:"No complaints for this business."}):(0,n.jsx)("p",{children:"Loading complaints..."})})]})]})})}},1163:function(e,t,s){e.exports=s(6036)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6178)}),_N_E=e.O()}]);