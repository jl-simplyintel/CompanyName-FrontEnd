(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[483],{4643:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/review/[id]",function(){return s(6547)}])},6547:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var n=s(5893),r=s(1163),a=s(7294),i=s(3299);function o(){let e=(0,r.useRouter)(),{id:t}=e.query,[s,o]=(0,a.useState)(null),[l,c]=(0,a.useState)([]),[d,m]=(0,a.useState)(0),[u,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(!1),{data:b}=(0,i.useSession)();(0,a.useEffect)(()=>{t&&(y(t),p(t))},[t]);let y=async e=>{try{let t=await fetch("http://localhost:3001/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n            {\n              business(where: { id: "'.concat(e,'" }) {\n                name\n              }\n            }')})}),s=await t.json();o(s.data.business)}catch(e){console.error("Error fetching business details:",e)}},p=async e=>{try{let t=await fetch("http://localhost:3001/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:'\n            {\n              business(where: { id: "'.concat(e,'" }) {\n                reviews(where: { moderationStatus: { equals: "0" } }) {\n                  id\n                  rating\n                  content\n                  isAnonymous\n                  user {\n                    name\n                  }\n                  createdAt\n                  replies {\n                    content\n                    createdAt\n                  }\n                }\n              }\n            }')})}),s=await t.json();c(s.data.business.reviews)}catch(e){console.error("Error fetching reviews:",e)}},w=async s=>{if(s.preventDefault(),!b){e.push("/auth/signin");return}try{console.log("Submitting Review with:",{rating:d.toString(),content:u,business:t,user:b.user.id,isAnonymous:x.toString(),moderationStatus:"2"});let e={rating:d.toString(),content:u,businessId:t,userId:b.user.id,isAnonymous:x.toString(),moderationStatus:"2"},s=await fetch("http://localhost:3001/api/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n                mutation CreateReview($rating: String!, $content: String!, $businessId: ID!, $userId: ID!, $isAnonymous: String!, $moderationStatus: String!) {\n                    createReview(data: {\n                        rating: $rating,\n                        content: $content,\n                        business: { connect: { id: $businessId } },\n                        user: { connect: { id: $userId } },\n                        isAnonymous: $isAnonymous,\n                        moderationStatus: $moderationStatus\n                    }) {\n                        id\n                    }\n                }\n            ",variables:e})}),n=await s.json();s.ok&&!n.errors?(m(0),h(""),g(!1),alert("Review submitted successfully! It is now awaiting approval.")):console.error("Error submitting review:",n.errors||s.statusText)}catch(e){console.error("Error submitting review:",e)}};return(0,n.jsx)("div",{className:"container mx-auto mt-10 p-4",children:(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"bg-white p-8 shadow-lg rounded-lg border-t-4 border-yellow-500",children:[(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)("i",{className:"bi bi-star text-yellow-500 text-3xl mr-2"}),(0,n.jsx)("h2",{className:"text-3xl font-bold",children:"Leave a Review"})]}),s&&(0,n.jsxs)("p",{className:"text-gray-600 mb-4",children:["Share your experience with ",(0,n.jsx)("strong",{children:s.name}),"!"]}),(0,n.jsxs)("form",{onSubmit:w,children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-lg mb-2",children:"Rating"}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:Array.from({length:5},(e,t)=>(0,n.jsx)("button",{type:"button",onClick:()=>m(t+1),className:"text-3xl ".concat(t<d?"text-yellow-500":"text-gray-400"),children:"â˜…"},t))})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{className:"block text-gray-700 text-lg mb-2",htmlFor:"reviewContent",children:"Your Review"}),(0,n.jsx)("textarea",{id:"reviewContent",className:"w-full p-3 border rounded-md focus:border-yellow-500 focus:ring-yellow-500",placeholder:"Share your thoughts about this business",rows:"4",value:u,onChange:e=>h(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"flex items-center mb-4",children:[(0,n.jsx)("input",{type:"checkbox",id:"anonymous",className:"mr-2",checked:x,onChange:e=>g(e.target.checked)}),(0,n.jsx)("label",{htmlFor:"anonymous",className:"text-gray-700",children:"Submit anonymously"})]}),(0,n.jsx)("button",{type:"submit",className:"bg-gradient-to-r from-yellow-500 to-yellow-700 text-white px-6 py-3 rounded-full hover:shadow-lg transition duration-300 ease-in-out",children:"Submit Review"})]})]}),(0,n.jsxs)("div",{className:"bg-white p-8 shadow-lg rounded-lg border-t-4 border-yellow-500",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"All Reviews"}),(0,n.jsx)("div",{className:"overflow-y-scroll",style:{maxHeight:"500px"},children:l.length>0?(0,n.jsx)("ul",{children:l.map(e=>{var t;return(0,n.jsxs)("li",{className:"mb-6 pb-4 border-b border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center mb-1",children:[(0,n.jsx)("div",{className:"flex items-center text-yellow-500",children:Array.from({length:5},(t,s)=>(0,n.jsx)("i",{className:"bi ".concat(s<e.rating?"bi-star-fill":"bi-star")},s))}),(0,n.jsxs)("span",{className:"ml-2 text-md font-semibold text-gray-700",children:[e.rating,"/5"]})]}),(0,n.jsxs)("div",{className:"mb-1",children:[(0,n.jsx)("p",{className:"text-sm text-gray-800",children:e.content}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["By: ",(0,n.jsx)("span",{className:"font-medium",children:"true"===e.isAnonymous?"Anonymous":(null===(t=e.user)||void 0===t?void 0:t.name)||"N/A"}),(0,n.jsx)("span",{className:"mx-2",children:"|"}),(0,n.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString()})]})]}),e.replies&&e.replies.length>0&&(0,n.jsxs)("div",{className:"mt-3 pl-3 border-l-4 border-yellow-300 bg-gray-100 p-2 rounded-md shadow-sm",children:[(0,n.jsx)("h4",{className:"text-sm font-semibold mb-1 text-gray-600",children:"Replies:"}),(0,n.jsx)("ul",{className:"space-y-1",children:e.replies.map((e,t)=>(0,n.jsxs)("li",{children:[(0,n.jsx)("h5",{className:"text-gray-800 font-medium text-sm",children:s.name}),(0,n.jsx)("p",{className:"text-xs text-gray-700",children:e.content}),(0,n.jsxs)("p",{className:"text-xs text-gray-400",children:["Posted on: ",new Date(e.createdAt).toLocaleDateString()]})]},t))})]})]},e.id)})}):(0,n.jsx)("p",{className:"text-gray-500",children:"No reviews yet for this business."})})]})]})})}},1163:function(e,t,s){e.exports=s(6036)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=4643)}),_N_E=e.O()}]);